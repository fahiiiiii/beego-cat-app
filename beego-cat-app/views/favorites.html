<!-- views/favourites.html -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favorites</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .grid-view img {
            width: 100%;
            height: auto;
        }

        /* List View */
        .list-view {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .list-view img {
            width: 50%;
            /* Set a fixed width for list view images */
            margin: 0 auto;
            display: block;
        }

        /* Horizontal List View */
        .horizontal-list-view {
            display: flex;
            overflow-x: auto;
            gap: 10px;
        }

        .horizontal-list-view img {
            width: auto;
            height: 200px;
            /* Fixed height for uniform display */
        }


        .gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .gallery img {
            width: 200px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        }

        .no-favs {
            text-align: center;
            margin-top: 50px;
            font-size: 18px;
            color: #6c757d;
        }

        button:hover {

            color: rgb(255 104 65);
        }
    </style>
</head>

<body class="bg-gray-50 ">

    <nav class="mx-auto flex items-center justify-around bg-white shadow-md py-4">

        <div class="relative">
            <button type="button"
                class="flex flex-col items-center w-full text-sm font-semibold gap-y-2 group hover:text-primary transition-colors duration-200 ease-in-out"
                onclick="location.href='voting.html';">
                <button type="button"
                    class="flex flex-col items-center w-full text-sm font-semibold gap-y-2 group  hover:text-primary transition-colors duration-200 ease-in-out"
                    onclick="location.href='voting.html';"><svg class="w-6 h-6 hover:stroke-primary hover:fill-primary"
                        fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px"
                        viewBox="0 0 377.03 377.031" xml:space="preserve">
                        <g>
                            <g>
                                <path
                                    d="M58.876,315.796h48.549c13.426,0,24.355-10.93,24.355-24.355V184.819c0-0.918,0.335-1.74,0.985-2.391
                    c0.631-0.611,1.463-0.956,2.4-0.956l13.961,0.115c7.287,0.096,11.628-2.668,14-5.002c2.869-2.858,4.437-6.665,4.437-10.738
                    c0-4.035-1.472-8.052-4.389-11.934l-62.701-83.806c-4.16-5.604-10.241-8.836-16.687-8.836c-6.436,0-12.527,3.194-16.706,8.779
                    l-62.682,83.48C1.482,157.414,0,161.449,0,165.503c0,7.86,6.292,15.835,18.322,15.835H31.04c1.913,0,3.471,1.568,3.471,3.472
                    v106.621C34.521,304.876,45.451,315.796,58.876,315.796z M28.171,160.483c-1.587,0-0.306-3.423,2.859-7.65l47-62.605
                    c3.174-4.227,8.3-4.217,11.465,0.009l46.952,62.778c3.165,4.227,4.198,7.641,2.324,7.631l-3.404-0.028
                    c-6.531-0.077-12.651,2.41-17.279,6.99c-4.638,4.58-7.191,10.7-7.191,17.222v106.622c0,1.922-1.559,3.471-3.471,3.471H58.876
                    c-1.913,0-3.481-1.549-3.481-3.471V184.819c0-13.406-10.93-24.336-24.346-24.336C31.049,160.483,29.758,160.483,28.171,160.483z">
                                </path>
                                <path
                                    d="M318.154,61.234h-48.549c-13.426,0-24.347,10.93-24.347,24.355V192.21c0,0.92-0.344,1.742-0.994,2.391
                    c-0.631,0.613-1.463,0.957-2.4,0.957l-13.961-0.115c-7.287-0.096-11.628,2.668-14,5.002c-2.868,2.859-4.437,6.664-4.437,10.738
                    c0,4.035,1.473,8.053,4.389,11.953l62.701,83.787c4.16,5.604,10.242,8.836,16.687,8.836c6.437,0,12.527-3.193,16.706-8.779
                    l62.673-83.48c2.926-3.883,4.408-7.918,4.408-11.973c0-7.859-6.292-15.834-18.321-15.834H345.99c-1.912,0-3.471-1.568-3.471-3.473
                    V85.599C342.51,72.164,331.58,61.234,318.154,61.234z M348.859,216.548c1.587,0,0.306,3.424-2.869,7.65L299,286.804
                    c-3.175,4.227-8.31,4.217-11.465-0.01l-46.952-62.77c-3.165-4.227-4.208-7.639-2.324-7.631l3.404,0.029
                    c6.531,0.076,12.651-2.41,17.28-6.98c4.638-4.58,7.19-10.701,7.19-17.223V85.599c0-1.922,1.559-3.471,3.472-3.471h48.549
                    c1.922,0,3.48,1.549,3.48,3.471V192.22c0,13.408,10.93,24.338,24.346,24.338C345.98,216.548,347.271,216.548,348.859,216.548z">
                                </path>
                            </g>
                        </g>
                    </svg>
                    Voting
                </button>
        </div>
        <!-- Breeds Button -->
        <div class="relative">
            <button type="button"
                class="flex flex-col items-center w-full text-sm font-semibold gap-y-2 group text-primary hover:text-primary transition-colors duration-200 ease-in-out"
                onclick="location.href='breeds.html';">
                <svg class="w-6 h-6 hover:stroke-primary hover:fill-primary" version="1.0" id="Layer_1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64"
                    enable-background="new 0 0 64 64" xml:space="preserve" stroke="currentColor">
                    <g>
                        <path fill="#231F20"
                            d="M62.242,53.757L51.578,43.093C54.373,38.736,56,33.56,56,28C56,12.536,43.464,0,28,0S0,12.536,0,28
                                        s12.536,28,28,28c5.56,0,10.736-1.627,15.093-4.422l10.664,10.664c2.344,2.344,6.142,2.344,8.485,0S64.586,56.101,62.242,53.757z
                                        M28,54C13.641,54,2,42.359,2,28S13.641,2,28,2s26,11.641,26,26S42.359,54,28,54z M60.828,60.828c-1.562,1.562-4.095,1.562-5.656,0
                                        L44.769,50.425c2.145-1.606,4.051-3.513,5.657-5.656l10.402,10.402C62.391,56.732,62.391,59.266,60.828,60.828z">
                        </path>
                    </g>
                </svg>
                Breeds
            </button>
        </div>
        <div class="relative">
            <button type="button"
                class="flex flex-col items-center w-full text-sm font-semibold gap-y-2 group hover:text-primary transition-colors duration-200 ease-in-out"
                onclick="location.href='favorites.html';">
                <svg class="w-6 h-6 hover:stroke-primary hover:fill-primary" version="1.0" id="Layer_1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64"
                    enable-background="new 0 0 64 64" xml:space="preserve" stroke="currentColor">
                    <g>
                        <path fill="#231F20"
                            d="M48,6c-4.418,0-8.418,1.791-11.313,4.687l-3.979,3.961c-0.391,0.391-1.023,0.391-1.414,0
                                        c0,0-3.971-3.97-3.979-3.961C24.418,7.791,20.418,6,16,6C7.163,6,0,13.163,0,22c0,3.338,1.024,6.436,2.773,9
                                        c0,0,0.734,1.164,1.602,2.031s24.797,24.797,24.797,24.797C29.953,58.609,30.977,59,32,59s2.047-0.391,2.828-1.172
                                        c0,0,23.93-23.93,24.797-24.797S61.227,31,61.227,31C62.976,28.436,64,25.338,64,22C64,13.163,56.837,6,48,6z M58.714,30.977
                                        c0,0-0.612,0.75-1.823,1.961S33.414,56.414,33.414,56.414C33.023,56.805,32.512,57,32,57s-1.023-0.195-1.414-0.586
                                        c0,0-22.266-22.266-23.477-23.477s-1.823-1.961-1.823-1.961C3.245,28.545,2,25.424,2,22C2,14.268,8.268,8,16,8
                                        c3.866,0,7.366,1.566,9.899,4.101l0.009-0.009l4.678,4.677c0.781,0.781,2.047,0.781,2.828,0l4.678-4.677l0.009,0.009
                                        C40.634,9.566,44.134,8,48,8c7.732,0,14,6.268,14,14C62,25.424,60.755,28.545,58.714,30.977z">
                        </path>
                        <path fill="#231F20" d="M48,12c-0.553,0-1,0.447-1,1s0.447,1,1,1c4.418,0,8,3.582,8,8c0,0.553,0.447,1,1,1s1-0.447,1-1
                                        C58,16.478,53.522,12,48,12z"></path>
                    </g>
                </svg>
                Favs
            </button>
        </div>

    </nav>


    <section class="container mx-auto py-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">Your Favorite Cats</h1>
        <div class="flex w-full py-4 bg-white gap-x-4">
            <div id="grid-view" class="block stroke-primary" role="button" tabindex="0">
                <svg class="w-6 h-6 block stroke-primary" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z">
                    </path>
                </svg>
            </div>
            <div class="relative">
                <div id="list-view" class="block " role="button" tabindex="0">
                    <svg class="w-6 h-6 block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z">
                        </path>
                    </svg>
                </div>
            </div>
        </div>
        <div id="favorites-container" class="gallery"></div>
        <div id="no-favs" class="no-favs hidden">
            <p>You have no favs yet!</p>

            <p>
                <button type="button"
                    class="flex flex-col items-center w-full text-2xl font-semibold text-primary gap-y-2 group dark:text-pink-500 hover:scale-125 group dark:text-pink-600 transition-transform ease-in-out"><svg
                        class="w-6 h-6" version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" enable-background="new 0 0 64 64"
                        xml:space="preserve" stroke="currentColor">
                        <g>
                            <path fill="#231F20" d="M64,28c0-3.314-2.687-6-6-6H41l0,0h-0.016H41l2-18c0.209-2.188-1.287-4-3.498-4h-4.001
                    C33,0,31.959,1.75,31,4l-8,18c-2.155,5.169-5,6-7,6c-1,0-2,0-2,0v-2c0-2.212-1.789-4-4-4H4c-2.211,0-4,1.788-4,4v34
                    c0,2.21,1.789,4,4,4h6c2.211,0,4-1.79,4-4v-2c1,0,3.632,0.052,6.21,2.697C23.324,63.894,27.043,64,29,64h23c3.313,0,6-2.688,6-6
                    c0-1.731-0.737-3.288-1.91-4.383C58.371,52.769,60,50.577,60,48c0-1.731-0.737-3.288-1.91-4.383C60.371,42.769,62,40.577,62,38
                    c0-1.731-0.737-3.288-1.91-4.383C62.371,32.769,64,30.577,64,28z M12,60c0,1.104-0.896,2-2,2H4c-1.104,0-2-0.896-2-2V26
                    c0-1.105,0.896-2,2-2h6c1.104,0,2,0.895,2,2V60z M58,32H48c-0.553,0-1,0.446-1,1c0,0.552,0.447,1,1,1h8c2.209,0,4,1.79,4,4
                    c0,2.209-1.791,4-4,4H46c-0.553,0-1,0.446-1,1c0,0.552,0.447,1,1,1h8c2.209,0,4,1.79,4,4c0,2.209-1.791,4-4,4H44
                    c-0.553,0-1,0.446-1,1c0,0.552,0.447,1,1,1h8c2.209,0,4,1.79,4,4c0,2.209-1.791,4-4,4H29c-1,0-4.695,0.034-7.358-2.699
                    C18.532,56.109,16.112,56.003,14,56V30h2c4,0,6.57-1.571,9.25-8L33,4c0.521-1.104,1.146-2,2.251-2H39c1.104,0,2.126,0.834,2,2
                    l-1.99,18c-0.132,1.673,0.914,2,1.99,2h17c2.209,0,4,1.79,4,4C62,30.209,60.209,32,58,32z"></path>
                            <path fill="#231F20" d="M7,54c-1.657,0-3,1.342-3,3c0,1.656,1.343,3,3,3s3-1.344,3-3C10,55.342,8.657,54,7,54z M7,58
                    c-0.553,0-1-0.449-1-1c0-0.553,0.447-1,1-1s1,0.447,1,1C8,57.551,7.553,58,7,58z"></path>
                        </g>
                    </svg></button>
            </p>
            <p>
                <a href="voting.html" class="text-pink-500 font-bold">Vote Now</a>
            </p>
        </div>
    </section>


    <!-- <script>

        class FavoritesManager {
            constructor() {
                this.API_KEY = 'live_MWfeRswpXVxIY3DPQoh0gxKrJL2aDXrtzCuW6I7x7Mam14MYUjseXffSrwHUIrTv';
                this.favoritesContainer = document.getElementById('favorites-container');
                this.loadingElement = document.getElementById('loading-favorites');
                this.sub_id = localStorage.getItem('sub_id');

                // Bind methods
                this.loadFavorites = this.loadFavorites.bind(this);
                this.removeFavorite = this.removeFavorite.bind(this);

                // Initialize
                if (this.sub_id) {
                    this.init();
                } else {
                    this.showError('No user ID found. Please view some cats first!');
                }
            }

            async init() {
                try {
                    await this.loadFavorites();
                    // Refresh favorites every 5 minutes
                    setInterval(this.loadFavorites, 300000);
                } catch (error) {
                    console.error('Failed to initialize favorites:', error);
                    this.showError('Failed to load favorites');
                }
            }

            async loadFavorites() {
                try {
                    this.showLoading();

                    const response = await fetch(`https://api.thecatapi.com/v1/favourites?sub_id=${this.sub_id}`, {
                        headers: {
                            'x-api-key': this.API_KEY
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const favorites = await response.json();
                    this.displayFavorites(favorites);

                    // Also notify our backend
                    await this.syncWithBackend(favorites);

                } catch (error) {
                    console.error('Error loading favorites:', error);
                    this.showError('Failed to load favorites');
                } finally {
                    this.hideLoading();
                }
            }

            async syncWithBackend(favorites) {
                try {
                    await fetch(`/api/syncFavorites/${this.sub_id}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ favorites })
                    });
                } catch (error) {
                    console.error('Error syncing with backend:', error);
                }
            }

            displayFavorites(favorites) {
                if (!this.favoritesContainer) return;

                this.favoritesContainer.innerHTML = '';

                if (favorites.length === 0) {
                    this.favoritesContainer.innerHTML = '<p>No favorites yet! Start adding some cats you love.</p>';
                    return;
                }

                favorites.forEach(favorite => {
                    const favoriteElement = document.createElement('div');
                    favoriteElement.className = 'favorite-item';

                    favoriteElement.innerHTML = `
                <img src="${favorite.image.url}" alt="Favorite Cat" />
                <button class="remove-favorite" data-id="${favorite.id}">
                    Remove from Favorites
                </button>
            `;

                    const removeButton = favoriteElement.querySelector('.remove-favorite');
                    removeButton.addEventListener('click', () => this.removeFavorite(favorite.id));

                    this.favoritesContainer.appendChild(favoriteElement);
                });
            }

            async removeFavorite(favoriteId) {
                try {
                    const response = await fetch(`https://api.thecatapi.com/v1/favourites/${favoriteId}`, {
                        method: 'DELETE',
                        headers: {
                            'x-api-key': this.API_KEY
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    // Refresh the favorites list
                    await this.loadFavorites();
                    this.showNotification('Favorite removed successfully!', 'success');

                } catch (error) {
                    console.error('Error removing favorite:', error);
                    this.showNotification('Failed to remove favorite', 'error');
                }
            }

            showLoading() {
                if (this.loadingElement) {
                    this.loadingElement.style.display = 'block';
                }
            }

            hideLoading() {
                if (this.loadingElement) {
                    this.loadingElement.style.display = 'none';
                }
            }

            showError(message) {
                if (this.favoritesContainer) {
                    this.favoritesContainer.innerHTML = `<p class="error-message">${message}</p>`;
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.classList.add('notification', type);
                notification.textContent = message;

                Object.assign(notification.style, {
                    position: 'fixed',
                    bottom: '20px',
                    right: '20px',
                    padding: '12px 24px',
                    borderRadius: '4px',
                    backgroundColor: type === 'success' ? '#4CAF50' : '#f44336',
                    color: 'white',
                    boxShadow: '0 2px 5px rgba(0,0,0,0.2)',
                    zIndex: '1000'
                });

                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }
        }
        // --------------------------------------------------------------------------------------------
        
        // --------------------------------------------------------------------------------------------
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.favoritesManager = new FavoritesManager();
        });
    </script> -->

    <!-- <script>
        class FavoritesManager {
            constructor() {
                this.favoritesContainer = document.getElementById('favorites-container');
                this.loadingElement = document.getElementById('loading-favorites');
                this.sub_id = localStorage.getItem('sub_id');
                this.ws = null;

                // Bind methods
                this.loadFavorites = this.loadFavorites.bind(this);
                this.removeFavorite = this.removeFavorite.bind(this);
                this.setupWebSocket = this.setupWebSocket.bind(this);
                this.handleWebSocketMessage = this.handleWebSocketMessage.bind(this);

                // Initialize
                if (this.sub_id) {
                    this.init();
                } else {
                    this.showError('No user ID found. Please view some cats first!');
                }
            }

            async init() {
                try {
                    this.setupWebSocket();
                    await this.loadFavorites();
                } catch (error) {
                    console.error('Failed to initialize favorites:', error);
                    this.showError('Failed to load favorites');
                }
            }

            setupWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsURL = `${protocol}//${window.location.host}/ws/favorites/${this.sub_id}`;

                this.ws = new WebSocket(wsURL);

                this.ws.onmessage = this.handleWebSocketMessage;

                this.ws.onclose = () => {
                    console.log('WebSocket connection closed. Attempting to reconnect...');
                    setTimeout(this.setupWebSocket, 3000);
                };

                this.ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                };
            }

            handleWebSocketMessage(event) {
                try {
                    const data = JSON.parse(event.data);
                    if (data.type === 'favorites_update') {
                        this.displayFavorites(data.favorites);
                    }
                } catch (error) {
                    console.error('Error handling WebSocket message:', error);
                }
            }

            async loadFavorites() {
                try {
                    this.showLoading();
                    const response = await fetch(`/api/favorites/${this.sub_id}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const favorites = await response.json();
                    this.displayFavorites(favorites);
                } catch (error) {
                    console.error('Error loading favorites:', error);
                    this.showError('Failed to load favorites');
                } finally {
                    this.hideLoading();
                }
            }

            async removeFavorite(favoriteId) {
                try {
                    const response = await fetch(`/api/favorites/${favoriteId}`, {
                        method: 'DELETE',
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    // The WebSocket will handle updating the UI when the server processes the deletion
                    this.showNotification('Favorite removed successfully!', 'success');
                } catch (error) {
                    console.error('Error removing favorite:', error);
                    this.showNotification('Failed to remove favorite', 'error');
                }
            }

            // Rest of the methods remain unchanged
            displayFavorites(favorites) {
                if (!this.favoritesContainer) return;

                this.favoritesContainer.innerHTML = '';

                if (favorites.length === 0) {
                    this.favoritesContainer.innerHTML = '<p>No favorites yet! Start adding some cats you love.</p>';
                    return;
                }

                favorites.forEach(favorite => {
                    const favoriteElement = document.createElement('div');
                    favoriteElement.className = 'favorite-item';

                    favoriteElement.innerHTML = `
                <img src="${favorite.image.url}" alt="Favorite Cat" />
                <button class="remove-favorite" data-id="${favorite.id}">
                    Remove from Favorites
                </button>
            `;

                    const removeButton = favoriteElement.querySelector('.remove-favorite');
                    removeButton.addEventListener('click', () => this.removeFavorite(favorite.id));

                    this.favoritesContainer.appendChild(favoriteElement);
                });
            }

            showLoading() {
                if (this.loadingElement) {
                    this.loadingElement.style.display = 'block';
                }
            }

            hideLoading() {
                if (this.loadingElement) {
                    this.loadingElement.style.display = 'none';
                }
            }

            showError(message) {
                if (this.favoritesContainer) {
                    this.favoritesContainer.innerHTML = `<p class="error-message">${message}</p>`;
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.classList.add('notification', type);
                notification.textContent = message;

                Object.assign(notification.style, {
                    position: 'fixed',
                    bottom: '20px',
                    right: '20px',
                    padding: '12px 24px',
                    borderRadius: '4px',
                    backgroundColor: type === 'success' ? '#4CAF50' : '#f44336',
                    color: 'white',
                    boxShadow: '0 2px 5px rgba(0,0,0,0.2)',
                    zIndex: '1000'
                });

                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.favoritesManager = new FavoritesManager();
        });
    </script> -->
    <!-- <script>

        class FavoritesManager {
            constructor() {
                this.API_KEY = 'live_MWfeRswpXVxIY3DPQoh0gxKrJL2aDXrtzCuW6I7x7Mam14MYUjseXffSrwHUIrTv';
                this.favoritesContainer = document.getElementById('favorites-container');
                this.loadingElement = document.getElementById('loading-favorites');
                this.sub_id = localStorage.getItem('sub_id');

                // Bind methods
                this.loadFavorites = this.loadFavorites.bind(this);
                this.removeFavorite = this.removeFavorite.bind(this);

                // Initialize
                if (this.sub_id) {
                    this.init();
                } else {
                    this.showError('No user ID found. Please view some cats first!');
                }
            }

            async init() {
                try {
                    await this.loadFavorites();
                    // Refresh favorites every 5 minutes
                    setInterval(this.loadFavorites, 300000);
                } catch (error) {
                    console.error('Failed to initialize favorites:', error);
                    this.showError('Failed to load favorites');
                }
            }

            // async loadFavorites() {
            //     try {
            //         this.showLoading();

            //         const response = await fetch(`/favorites/${this.sub_id}`);

            //         if (!response.ok) {
            //             throw new Error(`HTTP error! status: ${response.status}`);
            //         }

            //         const favorites = await response.json();

            //         // Check if favorites is an array and has items
            //         if (Array.isArray(favorites) && favorites.length > 0) {
            //             this.displayFavorites(favorites);
            //         } else {
            //             throw new Error('No favorites found');
            //         }

            //         // Notify backend (if needed)
            //         await this.syncWithBackend(favorites);

            //     } catch (error) {
            //         console.error('Error loading favorites:', error);
            //         this.showError('Failed to load favorites');
            //     } finally {
            //         this.hideLoading();
            //     }
            // }

            async loadFavorites() {
                try {
                    this.showLoading();

                    const response = await fetch(`/favorites/${this.sub_id}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const favorites = await response.json();

                    // Log the favorites to check their structure
                    console.log('Fetched favorites:', favorites);

                    // Check if favorites is an array and has items
                    if (Array.isArray(favorites) && favorites.length > 0) {
                        this.displayFavorites(favorites);
                    } else {
                        throw new Error('No favorites found');
                    }

                    // Notify backend (if needed)
                    await this.syncWithBackend(favorites);

                } catch (error) {
                    console.error('Error loading favorites:', error);
                    this.showError('Failed to load favorites');
                } finally {
                    this.hideLoading();
                }
            }


            async syncWithBackend(favorites) {
                try {
                    await fetch(`/api/syncFavorites/${this.sub_id}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ favorites })
                    });
                } catch (error) {
                    console.error('Error syncing with backend:', error);
                }
            }
            displayFavorites(favorites) {
                if (!this.favoritesContainer) return;

                this.favoritesContainer.innerHTML = ''; // Clear previous content

                if (favorites.length === 0) {
                    this.favoritesContainer.innerHTML = '<p>No favorites yet! Start adding some cats you love.</p>';
                    return;
                }

                favorites.forEach(favorite => {
                    const favoriteElement = document.createElement('div');
                    favoriteElement.className = 'favorite-item';

                    favoriteElement.innerHTML = `
            <img src="${favorite.image.url}" alt="Favorite Cat" />
            <button class="remove-favorite" data-id="${favorite.id}">
                Remove from Favorites
            </button>
        `;

                    const removeButton = favoriteElement.querySelector('.remove-favorite');
                    removeButton.addEventListener('click', () => this.removeFavorite(favorite.id));

                    this.favoritesContainer.appendChild(favoriteElement);
                });
            }


            // displayFavorites(favorites) {
            //     if (!this.favoritesContainer) return;

            //     this.favoritesContainer.innerHTML = '';

            //     if (favorites.length === 0) {
            //         this.favoritesContainer.innerHTML = '<p>No favorites yet! Start adding some cats you love.</p>';
            //         return;
            //     }

            //     favorites.forEach(favorite => {
            //         const favoriteElement = document.createElement('div');
            //         favoriteElement.className = 'favorite-item';

            //         favoriteElement.innerHTML = `
            //     <img src="${favorite.image.url}" alt="Favorite Cat" />
            //     <button class="remove-favorite" data-id="${favorite.id}">
            //         Remove from Favorites
            //     </button>
            // `;

            //         const removeButton = favoriteElement.querySelector('.remove-favorite');
            //         removeButton.addEventListener('click', () => this.removeFavorite(favorite.id));

            //         this.favoritesContainer.appendChild(favoriteElement);
            //     });
            // }

            async removeFavorite(favoriteId) {
                try {
                    const response = await fetch(`https://api.thecatapi.com/v1/favourites/${favoriteId}`, {
                        method: 'DELETE',
                        headers: {
                            'x-api-key': this.API_KEY
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    // Refresh the favorites list
                    await this.loadFavorites();
                    this.showNotification('Favorite removed successfully!', 'success');

                } catch (error) {
                    console.error('Error removing favorite:', error);
                    this.showNotification('Failed to remove favorite', 'error');
                }
            }

            showLoading() {
                if (this.loadingElement) {
                    this.loadingElement.style.display = 'block';
                }
            }

            hideLoading() {
                if (this.loadingElement) {
                    this.loadingElement.style.display = 'none';
                }
            }

            showError(message) {
                if (this.favoritesContainer) {
                    this.favoritesContainer.innerHTML = `<p class="error-message">${message}</p>`;
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.classList.add('notification', type);
                notification.textContent = message;

                Object.assign(notification.style, {
                    position: 'fixed',
                    bottom: '20px',
                    right: '20px',
                    padding: '12px 24px',
                    borderRadius: '4px',
                    backgroundColor: type === 'success' ? '#4CAF50' : '#f44336',
                    color: 'white',
                    boxShadow: '0 2px 5px rgba(0,0,0,0.2)',
                    zIndex: '1000'
                });

                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }
        }
        // --------------------------------------------------------------------------------------------

        // --------------------------------------------------------------------------------------------
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.favoritesManager = new FavoritesManager();
        });
    </script> -->

    <script>
        class FavoritesManager {
            constructor() {
                this.API_KEY = 'live_MWfeRswpXVxIY3DPQoh0gxKrJL2aDXrtzCuW6I7x7Mam14MYUjseXffSrwHUIrTv';
                this.favoritesContainer = document.getElementById('favorites-container');
                this.loadingElement = document.getElementById('loading-favorites');
                this.sub_id = localStorage.getItem('sub_id');
    
                // Bind methods
                this.loadFavorites = this.loadFavorites.bind(this);
                this.removeFavorite = this.removeFavorite.bind(this);
    
                // Initialize
                if (this.sub_id) {
                    this.init();
                } else {
                    this.showError('No user ID found. Please view some cats first!');
                }
            }
    
            async init() {
                try {
                    await this.loadFavorites();
                    // Refresh favorites every 5 minutes
                    setInterval(this.loadFavorites, 300000);
                } catch (error) {
                    console.error('Failed to initialize favorites:', error);
                    this.showError('Failed to load favorites');
                }
            }
    
            async loadFavorites() {
                try {
                    this.showLoading();
    
                    const response = await fetch(`/favorites/${this.sub_id}`);
    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
    
                    const favorites = await response.json();
    
                    // Check if favorites is an array and has items
                    if (Array.isArray(favorites) && favorites.length > 0) {
                        this.displayFavorites(favorites);
                    } else {
                        throw new Error('No favorites found');
                    }
    
                    // Notify backend (if needed)
                    await this.syncWithBackend(favorites);
    
                } catch (error) {
                    console.error('Error loading favorites:', error);
                    this.showError('Failed to load favorites');
                } finally {
                    this.hideLoading();
                }
            }
    
            async syncWithBackend(favorites) {
                try {
                    await fetch(`/api/syncFavorites/${this.sub_id}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ favorites })
                    });
                } catch (error) {
                    console.error('Error syncing with backend:', error);
                }
            }
    
            displayFavorites(favorites) {
                if (!this.favoritesContainer) return;
    
                this.favoritesContainer.innerHTML = '';
    
                if (favorites.length === 0) {
                    this.favoritesContainer.innerHTML = '<p>No favorites yet! Start adding some cats you love.</p>';
                    return;
                }
    
                favorites.forEach(favorite => {
                    const favoriteId = String(favorite.id);  // Ensure favorite.id is a string
    
                    const favoriteElement = document.createElement('div');
                    favoriteElement.className = 'favorite-item';
    
                    favoriteElement.innerHTML = `
                        <img src="${favorite.image.url}" alt="Favorite Cat" />
                        <button class="remove-favorite" data-id="${favoriteId}">
                            Remove from Favorites
                        </button>
                    `;
    
                    const removeButton = favoriteElement.querySelector('.remove-favorite');
                    removeButton.addEventListener('click', () => this.removeFavorite(favoriteId));
    
                    this.favoritesContainer.appendChild(favoriteElement);
                });
            }
    
            async removeFavorite(favoriteId) {
                try {
                    const response = await fetch(`https://api.thecatapi.com/v1/favourites/${favoriteId}`, {
                        method: 'DELETE',
                        headers: {
                            'x-api-key': this.API_KEY
                        }
                    });
    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
    
                    // Refresh the favorites list
                    await this.loadFavorites();
                    this.showNotification('Favorite removed successfully!', 'success');
    
                } catch (error) {
                    console.error('Error removing favorite:', error);
                    this.showNotification('Failed to remove favorite', 'error');
                }
            }
    
            showLoading() {
                if (this.loadingElement) {
                    this.loadingElement.style.display = 'block';
                }
            }
    
            hideLoading() {
                if (this.loadingElement) {
                    this.loadingElement.style.display = 'none';
                }
            }
    
            showError(message) {
                if (this.favoritesContainer) {
                    this.favoritesContainer.innerHTML = `<p class="error-message">${message}</p>`;
                }
            }
    
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.classList.add('notification', type);
                notification.textContent = message;
    
                Object.assign(notification.style, {
                    position: 'fixed',
                    bottom: '20px',
                    right: '20px',
                    padding: '12px 24px',
                    borderRadius: '4px',
                    backgroundColor: type === 'success' ? '#4CAF50' : '#f44336',
                    color: 'white',
                    boxShadow: '0 2px 5px rgba(0,0,0,0.2)',
                    zIndex: '1000'
                });
    
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }
        }
    
        document.addEventListener('DOMContentLoaded', () => {
            window.favoritesManager = new FavoritesManager();
        });
    </script>
    

</body>

</html>