<!-- views/voting.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .carousel {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 400px;
            background-color: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        }

        .carousel img {
            max-width: 100%;
            max-height: 100%;
            transition: opacity 0.5s ease-in-out;
        }

        .hidden {
            opacity: 0;
        }

        .visible {
            opacity: 1;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .favorite-btn {
            color: #ff4d4d;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .favorite-btn:hover {
            color: rgb(255, 104, 65);
        }

        .vote-btns {
            display: flex;
            gap: 10px;
        }

        .vote-btn {
            background-color: #fff;
            color: #6c757d;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .vote-btn:hover,
        button:hover {
            color: rgb(255, 104, 65);
        }
    </style>
</head>

<body class="bg-gray-50">
    <nav class="mx-auto flex items-center justify-around bg-white shadow-md py-4">

        <div class="relative">
            <button type="button"
                class="flex flex-col items-center w-full text-sm font-semibold gap-y-2 group hover:text-primary transition-colors duration-200 ease-in-out"
                onclick="location.href='voting.html';">
                <button type="button"
                    class="flex flex-col items-center w-full text-sm font-semibold gap-y-2 group  hover:text-primary transition-colors duration-200 ease-in-out"><svg
                        class="w-6 h-6 hover:stroke-primary hover:fill-primary" fill="#000000" version="1.1" id="Capa_1"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                        height="24px" viewBox="0 0 377.03 377.031" xml:space="preserve">
                        <g>
                            <g>
                                <path
                                    d="M58.876,315.796h48.549c13.426,0,24.355-10.93,24.355-24.355V184.819c0-0.918,0.335-1.74,0.985-2.391
                    c0.631-0.611,1.463-0.956,2.4-0.956l13.961,0.115c7.287,0.096,11.628-2.668,14-5.002c2.869-2.858,4.437-6.665,4.437-10.738
                    c0-4.035-1.472-8.052-4.389-11.934l-62.701-83.806c-4.16-5.604-10.241-8.836-16.687-8.836c-6.436,0-12.527,3.194-16.706,8.779
                    l-62.682,83.48C1.482,157.414,0,161.449,0,165.503c0,7.86,6.292,15.835,18.322,15.835H31.04c1.913,0,3.471,1.568,3.471,3.472
                    v106.621C34.521,304.876,45.451,315.796,58.876,315.796z M28.171,160.483c-1.587,0-0.306-3.423,2.859-7.65l47-62.605
                    c3.174-4.227,8.3-4.217,11.465,0.009l46.952,62.778c3.165,4.227,4.198,7.641,2.324,7.631l-3.404-0.028
                    c-6.531-0.077-12.651,2.41-17.279,6.99c-4.638,4.58-7.191,10.7-7.191,17.222v106.622c0,1.922-1.559,3.471-3.471,3.471H58.876
                    c-1.913,0-3.481-1.549-3.481-3.471V184.819c0-13.406-10.93-24.336-24.346-24.336C31.049,160.483,29.758,160.483,28.171,160.483z">
                                </path>
                                <path
                                    d="M318.154,61.234h-48.549c-13.426,0-24.347,10.93-24.347,24.355V192.21c0,0.92-0.344,1.742-0.994,2.391
                    c-0.631,0.613-1.463,0.957-2.4,0.957l-13.961-0.115c-7.287-0.096-11.628,2.668-14,5.002c-2.868,2.859-4.437,6.664-4.437,10.738
                    c0,4.035,1.473,8.053,4.389,11.953l62.701,83.787c4.16,5.604,10.242,8.836,16.687,8.836c6.437,0,12.527-3.193,16.706-8.779
                    l62.673-83.48c2.926-3.883,4.408-7.918,4.408-11.973c0-7.859-6.292-15.834-18.321-15.834H345.99c-1.912,0-3.471-1.568-3.471-3.473
                    V85.599C342.51,72.164,331.58,61.234,318.154,61.234z M348.859,216.548c1.587,0,0.306,3.424-2.869,7.65L299,286.804
                    c-3.175,4.227-8.31,4.217-11.465-0.01l-46.952-62.77c-3.165-4.227-4.208-7.639-2.324-7.631l3.404,0.029
                    c6.531,0.076,12.651-2.41,17.28-6.98c4.638-4.58,7.19-10.701,7.19-17.223V85.599c0-1.922,1.559-3.471,3.472-3.471h48.549
                    c1.922,0,3.48,1.549,3.48,3.471V192.22c0,13.408,10.93,24.338,24.346,24.338C345.98,216.548,347.271,216.548,348.859,216.548z">
                                </path>
                            </g>
                        </g>
                    </svg>
                    Voting
                </button>
        </div>
        <!-- Breeds Button -->
        <div class="relative">
            <button type="button"
                class="flex flex-col items-center w-full text-sm font-semibold gap-y-2 group text-primary hover:text-primary transition-colors duration-200 ease-in-out"
                onclick="location.href='breeds.html';">
                <svg class="w-6 h-6 hover:stroke-primary hover:fill-primary" version="1.0" id="Layer_1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64"
                    enable-background="new 0 0 64 64" xml:space="preserve" stroke="currentColor">
                    <g>
                        <path fill="#231F20"
                            d="M62.242,53.757L51.578,43.093C54.373,38.736,56,33.56,56,28C56,12.536,43.464,0,28,0S0,12.536,0,28
                                        s12.536,28,28,28c5.56,0,10.736-1.627,15.093-4.422l10.664,10.664c2.344,2.344,6.142,2.344,8.485,0S64.586,56.101,62.242,53.757z
                                        M28,54C13.641,54,2,42.359,2,28S13.641,2,28,2s26,11.641,26,26S42.359,54,28,54z M60.828,60.828c-1.562,1.562-4.095,1.562-5.656,0
                                        L44.769,50.425c2.145-1.606,4.051-3.513,5.657-5.656l10.402,10.402C62.391,56.732,62.391,59.266,60.828,60.828z">
                        </path>
                    </g>
                </svg>
                Breeds
            </button>
        </div>
        <div class="relative">
            <button type="button"
                class="flex flex-col items-center w-full text-sm font-semibold gap-y-2 group hover:text-primary transition-colors duration-200 ease-in-out"
                onclick="location.href='favorites.html';">
                <svg class="w-6 h-6 hover:stroke-primary hover:fill-primary" version="1.0" id="Layer_1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64"
                    enable-background="new 0 0 64 64" xml:space="preserve" stroke="currentColor">
                    <g>
                        <path fill="#231F20"
                            d="M48,6c-4.418,0-8.418,1.791-11.313,4.687l-3.979,3.961c-0.391,0.391-1.023,0.391-1.414,0
                                        c0,0-3.971-3.97-3.979-3.961C24.418,7.791,20.418,6,16,6C7.163,6,0,13.163,0,22c0,3.338,1.024,6.436,2.773,9
                                        c0,0,0.734,1.164,1.602,2.031s24.797,24.797,24.797,24.797C29.953,58.609,30.977,59,32,59s2.047-0.391,2.828-1.172
                                        c0,0,23.93-23.93,24.797-24.797S61.227,31,61.227,31C62.976,28.436,64,25.338,64,22C64,13.163,56.837,6,48,6z M58.714,30.977
                                        c0,0-0.612,0.75-1.823,1.961S33.414,56.414,33.414,56.414C33.023,56.805,32.512,57,32,57s-1.023-0.195-1.414-0.586
                                        c0,0-22.266-22.266-23.477-23.477s-1.823-1.961-1.823-1.961C3.245,28.545,2,25.424,2,22C2,14.268,8.268,8,16,8
                                        c3.866,0,7.366,1.566,9.899,4.101l0.009-0.009l4.678,4.677c0.781,0.781,2.047,0.781,2.828,0l4.678-4.677l0.009,0.009
                                        C40.634,9.566,44.134,8,48,8c7.732,0,14,6.268,14,14C62,25.424,60.755,28.545,58.714,30.977z">
                        </path>
                        <path fill="#231F20" d="M48,12c-0.553,0-1,0.447-1,1s0.447,1,1,1c4.418,0,8,3.582,8,8c0,0.553,0.447,1,1,1s1-0.447,1-1
                                        C58,16.478,53.522,12,48,12z"></path>
                    </g>
                </svg>
                Favs
            </button>
        </div>

    </nav>

    <section class="container mx-auto py-8">
        <div class="carousel">
            <img id="cat-image" class="visible" src="" alt="Cat Image">
        </div>

        <div class="actions">
            <button id="favorite" class="favorite-btn relative flex items-center">
                <span
                    class="absolute top-0 right-0 inline-flex w-2 h-2 rounded-full opacity-75 animate-ping bg-primary"></span>
                <div class="relative flex flex-col items-center w-full text-sm font-semibold hover:scale-125  transition-transform ease-in-out"
                    aria-label="Add to favourites">
                    <svg class="w-6 h-6 hover:stroke-primary hover:fill-primary" version="1.0" id="Layer_1"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve"
                        stroke="currentColor">
                        <g>
                            <path fill="#231F20"
                                d="M48,6c-4.418,0-8.418,1.791-11.313,4.687l-3.979,3.961c-0.391,0.391-1.023,0.391-1.414,0
                                c0,0-3.971-3.97-3.979-3.961C24.418,7.791,20.418,6,16,6C7.163,6,0,13.163,0,22c0,3.338,1.024,6.436,2.773,9
                                c0,0,0.734,1.164,1.602,2.031s24.797,24.797,24.797,24.797C29.953,58.609,30.977,59,32,59s2.047-0.391,2.828-1.172
                                c0,0,23.93-23.93,24.797-24.797S61.227,31,61.227,31C62.976,28.436,64,25.338,64,22C64,13.163,56.837,6,48,6z M58.714,30.977
                                c0,0-0.612,0.75-1.823,1.961S33.414,56.414,33.414,56.414C33.023,56.805,32.512,57,32,57s-1.023-0.195-1.414-0.586
                                c0,0-22.266-22.266-23.477-23.477s-1.823-1.961-1.823-1.961C3.245,28.545,2,25.424,2,22C2,14.268,8.268,8,16,8
                                c3.866,0,7.366,1.566,9.899,4.101l0.009-0.009l4.678,4.677c0.781,0.781,2.047,0.781,2.828,0l4.678-4.677l0.009,0.009
                                C40.634,9.566,44.134,8,48,8c7.732,0,14,6.268,14,14C62,25.424,60.755,28.545,58.714,30.977z"></path>
                            <path fill="#231F20" d="M48,12c-0.553,0-1,0.447-1,1s0.447,1,1,1c4.418,0,8,3.582,8,8c0,0.553,0.447,1,1,1s1-0.447,1-1
                                C58,16.478,53.522,12,48,12z"></path>
                        </g>
                    </svg>
                </div>
            </button>


            <div class="vote-btns">
                <button id="like"
                    class="vote-btn flex flex-col items-center w-full text-sm font-semibold hover:scale-125 transition-transform ease-in-out"
                    aria-label="Upvote">
                    <svg class="w-6 h-6 hover:stroke-primary hover:fill-primary" version="1.0" id="Layer_1"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve"
                        stroke="currentColor">
                        <g>
                            <path fill="#231F20" d="M64,28c0-3.314-2.687-6-6-6H41l0,0h-0.016H41l2-18c0.209-2.188-1.287-4-3.498-4h-4.001
                               C33,0,31.959,1.75,31,4l-8,18c-2.155,5.169-5,6-7,6c-1,0-2,0-2,0v-2c0-2.212-1.789-4-4-4H4c-2.211,0-4,1.788-4,4v34
                               c0,2.21,1.789,4,4,4h6c2.211,0,4-1.79,4-4v-2c1,0,3.632,0.052,6.21,2.697C23.324,63.894,27.043,64,29,64h23c3.313,0,6-2.688,6-6
                               c0-1.731-0.737-3.288-1.91-4.383C58.371,52.769,60,50.577,60,48c0-1.731-0.737-3.288-1.91-4.383C60.371,42.769,62,40.577,62,38
                               c0-1.731-0.737-3.288-1.91-4.383C62.371,32.769,64,30.577,64,28z M12,60c0,1.104-0.896,2-2,2H4c-1.104,0-2-0.896-2-2V26
                               c0-1.105,0.896-2,2-2h6c1.104,0,2,0.895,2,2V60z M58,32H48c-0.553,0-1,0.446-1,1c0,0.552,0.447,1,1,1h8c2.209,0,4,1.79,4,4
                               c0,2.209-1.791,4-4,4H46c-0.553,0-1,0.446-1,1c0,0.552,0.447,1,1,1h8c2.209,0,4,1.79,4,4c0,2.209-1.791,4-4,4H44
                               c-0.553,0-1,0.446-1,1c0,0.552,0.447,1,1,1h8c2.209,0,4,1.79,4,4c0,2.209-1.791,4-4,4H29c-1,0-4.695,0.034-7.358-2.699
                               C18.532,56.109,16.112,56.003,14,56V30h2c4,0,6.57-1.571,9.25-8L33,4c0.521-1.104,1.146-2,2.251-2H39c1.104,0,2.126,0.834,2,2
                               l-1.99,18c-0.132,1.673,0.914,2,1.99,2h17c2.209,0,4,1.79,4,4C62,30.209,60.209,32,58,32z">
                            </path>
                            <path fill="#231F20" d="M7,54c-1.657,0-3,1.342-3,3c0,1.656,1.343,3,3,3s3-1.344,3-3C10,55.342,8.657,54,7,54z M7,58
                               c-0.553,0-1-0.449-1-1c0-0.553,0.447-1,1-1s1,0.447,1,1C8,57.551,7.553,58,7,58z"></path>
                        </g>
                    </svg>
                </button>

                <button id="dislike"
                    class="vote-btn flex flex-col items-center w-full text-sm font-semibold hover:scale-125 transition-transform ease-in-out"
                    aria-label="Downvote">
                    <svg class="w-6 h-6 hover:stroke-primary hover:fill-primary" version="1.0" id="Layer_1"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve"
                        stroke="currentColor">
                        <g>
                            <path d="M64,36c0,3.312-2.687,6-6,6H41v-0.002L40.984,42H41l2,18c0.209,2.186-1.287,4-3.498,4h-4.001
                        C33,64,31.959,62.248,31,60l-8-18c-2.155-5.171-5-6-7-6c-1,0-2,0-2,0v2c0,2.21-1.789,4-4,4H4c-2.211,0-4-1.79-4-4V4
                        c0-2.212,1.789-4,4-4h6c2.211,0,4,1.788,4,4v2c1,0,3.632-0.054,6.21-2.699C23.324,0.104,27.043,0,29,0h23c3.313,0,6,2.686,6,6
                        c0,1.729-0.737,3.286-1.91,4.381C58.371,11.229,60,13.421,60,16c0,1.729-0.737,3.286-1.91,4.381C60.371,21.229,62,23.421,62,26
                        c0,1.729-0.737,3.286-1.91,4.381C62.371,31.229,64,33.421,64,36z M12,4c0-1.105-0.896-2-2-2H4C2.896,2,2,2.895,2,4v34
                        c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2V4z M58,32H48c-0.553,0-1-0.448-1-1c0-0.554,0.447-1,1-1h8c2.209,0,4-1.791,4-4
                        c0-2.21-1.791-4-4-4H46c-0.553,0-1-0.448-1-1c0-0.554,0.447-1,1-1h8c2.209,0,4-1.791,4-4c0-2.21-1.791-4-4-4H44
                        c-0.553,0-1-0.448-1-1c0-0.554,0.447-1,1-1h8c2.209,0,4-1.791,4-4c0-2.21-1.791-4-4-4H29c-1,0-4.695-0.036-7.358,2.697
                        C18.532,7.889,16.112,7.995,14,8v26h2c4,0,6.57,1.569,9.25,8L33,60c0.521,1.103,1.146,2,2.251,2H39c1.104,0,2.126-0.834,2-2
                        l-1.99-18c-0.132-1.675,0.914-2,1.99-2h17c2.209,0,4-1.791,4-4C62,33.79,60.209,32,58,32z"></path>
                            <path d="M7,38c-1.657,0-3-1.344-3-3c0-1.658,1.343-3,3-3s3,1.342,3,3C10,36.656,8.657,38,7,38z M7,34
                        c-0.553,0-1,0.447-1,1c0,0.551,0.447,1,1,1s1-0.449,1-1C8,34.447,7.553,34,7,34z"></path>
                        </g>
                    </svg>
                </button>

            </div>
        </div>
    </section>


    <script>
        class CatImageCarousel {
            constructor() {
                this.breedImages = [];
                this.currentImageIndex = 0;
                this.isLoading = false;
                this.API_KEY = 'live_MWfeRswpXVxIY3DPQoh0gxKrJL2aDXrtzCuW6I7x7Mam14MYUjseXffSrwHUIrTv'; // Replace with your actual API key

                // DOM Elements
                this.imageElement = document.getElementById('cat-image');
                this.favoriteButton = document.getElementById('favorite');
                this.likeButton = document.getElementById('like'); // Assuming you have a like button with id 'like'
                this.dislikeButton = document.getElementById('dislike'); // Assuming you have a dislike button with id 'dislike'

                // Bind methods
                this.addToFavorites = this.addToFavorites.bind(this);
                this.handleImageError = this.handleImageError.bind(this);
                this.handleButtonClick = this.handleButtonClick.bind(this);

                // Event listeners
                this.favoriteButton.addEventListener('click', this.addToFavorites);
                this.favoriteButton.addEventListener('click', this.handleButtonClick);
                this.likeButton.addEventListener('click', this.handleButtonClick);
                this.dislikeButton.addEventListener('click', this.handleButtonClick);
                this.imageElement.addEventListener('error', this.handleImageError);


                this.likeButton.removeEventListener('click', this.handleButtonClick);
                this.dislikeButton.removeEventListener('click', this.handleButtonClick);
                // this.likeButton.addEventListener('click', () => this.handleVote(1));
                // this.dislikeButton.addEventListener('click', () => this.handleVote(0));


                this.likeButton.addEventListener('click', () => this.handleVote(1));
                this.dislikeButton.addEventListener('click', () => this.handleVote(0));

                // Initialize
                this.init();
            }

            async init() {
                // Ensure we have a sub_id
                this.ensureUserId();
                await this.fetchImagesFromBackend();
                setInterval(() => this.fetchImagesFromBackend(), 300000); // Refresh images every 5 minutes
            }

            ensureUserId() {
                let userId = localStorage.getItem('sub_id');
                if (!userId) {
                    // Create a unique ID combining timestamp and random string
                    userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    localStorage.setItem('sub_id', userId);
                }
                this.sub_id = userId;
                console.log('Using sub_id:', this.sub_id); // Debug log
            }


            async fetchImagesFromBackend() {
                if (this.isLoading) return;

                try {
                    this.isLoading = true;
                    this.showLoadingState();

                    const response = await fetch('/api/getImages', {
                        method: 'GET',
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    this.breedImages = data.map(image => ({
                        id: image.id,
                        url: image.url
                    }));

                    if (this.breedImages.length > 0) {
                        this.currentImageIndex = 0;
                        this.updateImage();
                    } else {
                        throw new Error('No images received from server');
                    }
                } catch (error) {
                    console.error("Error fetching images:", error);
                    this.handleError(error);
                } finally {
                    this.isLoading = false;
                    this.hideLoadingState();
                }
            }

            updateImage() {
                if (this.imageElement && this.breedImages[this.currentImageIndex]) {
                    this.imageElement.src = this.breedImages[this.currentImageIndex].url;
                }
            }

            // Change image when Like, Dislike, or Favorite buttons are clicked
            handleButtonClick() {
                // Move to the next image in the array (loop back to the start)
                this.currentImageIndex = (this.currentImageIndex + 1) % this.breedImages.length;
                this.updateImage(); // Update the displayed image
            }

            async addToFavorites() {
                const currentImage = this.breedImages[this.currentImageIndex];
                if (!currentImage) {
                    this.showNotification('No image selected', 'error');
                    return;
                }

                try {
                    // First, save to The Cat API
                    const response = await fetch('https://api.thecatapi.com/v1/favourites', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': this.API_KEY
                        },
                        body: JSON.stringify({
                            image_id: currentImage.id,
                            sub_id: this.sub_id
                        })
                    });

                    // Handle authentication error
                    if (response.status === 401) {
                        throw new Error('Authentication failed. Please check your API key.');
                    }

                    // Handle other errors
                    if (!response.ok) {
                        const errorText = await response.text();
                        try {
                            const errorJson = JSON.parse(errorText);
                            throw new Error(errorJson.message || 'Failed to save favorite');
                        } catch (e) {
                            throw new Error(`Failed to save favorite: ${errorText}`);
                        }
                    }

                    const data = await response.json();
                    console.log('Favorite saved successfully:', data);
                    this.showNotification('Added to favorites!', 'success');

                    // Then notify our backend
                    await this.notifyBackend(currentImage);

                } catch (error) {
                    console.error('Error saving to favorites:', error);
                    this.showNotification(error.message, 'error');
                }
            }
            async handleVote(value) {
                const currentImage = this.breedImages[this.currentImageIndex];
                if (!currentImage) {
                    this.showNotification('No image selected', 'error');
                    return;
                }

                try {
                    // Send vote to our backend
                    const response = await fetch(`/api/vote/${this.sub_id}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            image_id: currentImage.id,
                            value: value // 1 for like, 0 for dislike
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Failed to save vote');
                    }

                    const data = await response.json();
                    console.log('Vote saved successfully:', data);
                    this.showNotification(value === 1 ? 'Liked!' : 'Disliked!', 'success');

                    // Move to next image after successful vote
                    this.handleButtonClick();

                } catch (error) {
                    console.error('Error saving vote:', error);
                    this.showNotification(error.message, 'error');
                }
            }

            async notifyBackend(image) {
                try {
                    const response = await fetch(`/api/saveFavorite/${this.sub_id}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            image_id: image.id,
                            image_url: image.url
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        try {
                            const errorJson = JSON.parse(errorText);
                            throw new Error(errorJson.message || 'Failed to notify backend');
                        } catch (e) {
                            throw new Error(`Failed to notify backend: ${errorText}`);
                        }
                    }

                    const data = await response.json();
                    console.log('Backend notified successfully:', data);
                } catch (error) {
                    console.error('Error notifying backend:', error);
                }
            }



            handleImageError() {
                this.imageElement.src = '/api/placeholder/400/300?text=Error+Loading+Image';
                this.showNotification('Failed to load image', 'error');
            }

            handleError(error) {
                this.showNotification(`Error: ${error.message}`, 'error');
            }

            showLoadingState() {
                if (this.imageElement) {
                    this.imageElement.classList.add('opacity-50');
                }
            }

            hideLoadingState() {
                if (this.imageElement) {
                    this.imageElement.classList.remove('opacity-50');
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.classList.add('notification', type);
                notification.textContent = message;

                // Style the notification
                Object.assign(notification.style, {
                    position: 'fixed',
                    bottom: '20px',
                    right: '20px',
                    padding: '12px 24px',
                    borderRadius: '4px',
                    backgroundColor: type === 'success' ? '#4CAF50' :
                        type === 'error' ? '#f44336' : '#2196F3',
                    color: 'white',
                    boxShadow: '0 2px 5px rgba(0,0,0,0.2)',
                    transition: 'opacity 0.3s ease',
                    zIndex: '1000'
                });

                document.body.appendChild(notification);

                // Remove the notification after 3 seconds
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 3000);
            }







            // Clean up method to be called when the component is destroyed
            destroy() {
                // Clear image rotation interval if it's set
                if (this.imageInterval) {
                    clearInterval(this.imageInterval);
                }

                // Remove event listeners
                if (this.favoriteButton) {
                    this.favoriteButton.removeEventListener('click', this.addToFavorites);
                    this.favoriteButton.removeEventListener('click', this.handleButtonClick);
                }
                // if (this.likeButton) {
                //     this.likeButton.removeEventListener('click', () => this.handleVote(1));
                // }
                // if (this.dislikeButton) {
                //     this.dislikeButton.removeEventListener('click', () => this.handleVote(0));
                // }
                if (this.likeButton) {
                    this.likeButton.removeEventListener('click', this.handleButtonClick);
                }
                if (this.dislikeButton) {
                    this.dislikeButton.removeEventListener('click', this.handleButtonClick);
                }

                if (this.imageElement) {
                    this.imageElement.removeEventListener('error', this.handleImageError);
                }

                // if (this.likeButton) {
                //     this.likeButton.removeEventListener('click', () => this.handleVote(1));
                // }
                // if (this.dislikeButton) {
                //     this.dislikeButton.removeEventListener('click', () => this.handleVote(0));
                // }

                // if (this.likeButton) {
                //     this.likeButton.removeEventListener('click', () => this.handleVote(1));
                // }
                // if (this.dislikeButton) {
                //     this.dislikeButton.removeEventListener('click', () => this.handleVote(0));
                // }
                if (this.likeButton) {
                    this.likeButton.removeEventListener('click', () => this.handleVote(1));
                }
                if (this.dislikeButton) {
                    this.dislikeButton.removeEventListener('click', () => this.handleVote(0));
                }
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.catCarousel = new CatImageCarousel();
        });
    </script>




</body>

</html>

